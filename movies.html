<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Night Picker</title>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-REQ35S9P5Y"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-REQ35S9P5Y');
</script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        /* ===== GENERAL STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f1a1c2;
            color: #333;
            min-height: 100vh;
            padding-left: 100px; /* Space for left nav */
            padding-right: 100px; /* Space for right nav */
            position: relative;
            overflow-x: hidden;
        }

        /* ===== LEFT NAVIGATION BAR ===== */
        .nav-container-left {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 100px;
            background-color: #2a0a3a;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 30px;
            z-index: 1000;
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.2);
            border-right: 3px solid #ff9ec6;
        }

        /* ===== RIGHT NAVIGATION BAR ===== */
        .nav-container-right {
            position: fixed;
            right: 0;
            top: 0;
            height: 100vh;
            width: 100px;
            background-color: #2a0a3a;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 30px;
            z-index: 1000;
            box-shadow: -4px 0 10px rgba(0, 0, 0, 0.2);
            border-left: 3px solid #ff9ec6;
        }

        .nav-item { /* Common style for all nav items */
            width: 100%;
            text-align: center;
            padding: 15px 0;
            margin: 10px 0;
            color: white;
            font-size: 0.9em;
            text-decoration: none;
            transition: all 0.3s;
        }

        .nav-item:hover {
            background-color: #9b4d96;
            transform: scale(1.05);
        }

        .nav-item img {
            width: 50px;
            height: 50px;
            object-fit: contain;
            margin-bottom: 8px;
        }

        .active {
            background-color: #ff66a3;
            font-weight: bold;
        }

        /* ===== MAIN CONTENT WRAPPER ===== */
        .page-wrapper {
            max-width: 800px; /* Adjust as needed for movie picker content */
            margin: 0 auto; /* Center between navs */
            padding: 20px;
            position: relative;
        }

        /* ===== HEADER STYLES ===== */
        header {
            background-color: #9b4d96;
            color: white;
            padding: 20px;
            font-size: 2em;
            text-transform: uppercase;
            font-weight: bold;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            text-align: center;
        }

        /* ===== MAIN CONTENT STYLES (for movie picker) ===== */
        main {
            width: 100%;
            padding: 20px; /* Adjusted padding */
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 40px;
            position: relative;
        }

        /* ===== MOVIE PICKER STYLES ===== */
        .genre-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); /* Slightly smaller cards */
            gap: 15px;
            margin-bottom: 30px;
        }

        .genre-card {
            background-color: #f5a9bc;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        .genre-card:hover { background-color: #e91e63; color: white; transform: translateY(-5px); }
        .genre-card h3 { margin-bottom: 5px; font-family: 'Pacifico', cursive; }

        .movies-container {
            display: none; background-color: #fff8fa; padding: 20px;
            border-radius: 10px; margin-top: 20px; border-left: 5px solid #9b4d96;
        }
        .movie-item {
            padding: 10px; margin: 10px 0; background-color: white;
            border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s; display: flex; justify-content: space-between; align-items: center;
        }
        .movie-item:hover { background-color: #f1a1c2; color: white; }
        .movie-actions { display: flex; align-items: center; gap: 10px; }
        .star-rating { display: flex; gap: 2px; }
        .star { color: #ccc; cursor: pointer; font-size: 18px; transition: color 0.2s; }
        .star.active { color: #ffb700; }
        .watched-btn { background-color: #9b4d96; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px; transition: all 0.3s; }
        .watched-btn:hover { background-color: #ff66a3; transform: scale(1.05); }
        .undo-btn { background-color: #5a005a; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px; transition: all 0.3s; }
        .undo-btn:hover { background-color: #8e44ad; transform: scale(1.05); }
        
        .watched-container { margin-top: 30px; background-color: #f0f8ff; padding: 20px; border-radius: 10px; border-left: 5px solid #5a005a; }
        .watched-movie { display: flex; justify-content: space-between; align-items: center; padding: 10px; margin: 10px 0; background-color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .watched-movie:hover { background-color: #e6f2ff; }
        .watched-movie-actions { display: flex; align-items: center; gap: 10px; }
        .rating-display { color: #ffb700; font-weight: bold; }

        .reset-controls { background-color: #ffecf2; border-radius: 10px; padding: 15px; margin-bottom: 25px; text-align: center; border-left: 5px solid #ff4081; }
        .reset-btn { background-color: #ff4081; color: white; border: none; border-radius: 8px; padding: 10px 20px; cursor: pointer; font-size: 16px; transition: all 0.3s; margin-top: 10px; }
        .reset-btn:hover { background-color: #c2185b; transform: scale(1.05); }

        .action-buttons { display: flex; justify-content: center; gap: 20px; margin-top: 20px; margin-bottom: 30px; flex-wrap: wrap; /* Allow wrapping */ }
        .action-btn { background-color: #9b4d96; color: white; border: none; border-radius: 8px; padding: 12px 20px; cursor: pointer; font-size: 16px; transition: all 0.3s; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .action-btn:hover { background-color: #ff66a3; transform: translateY(-4px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .action-btn i { font-size: 20px; }
        
        .confirmation-dialog { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.3); z-index: 2000; text-align: center; display: none; border: 3px solid #9b4d96; width: 90%; max-width: 500px; }
        .confirmation-dialog p { margin-bottom: 20px; font-size: 18px; }
        .dialog-buttons { display: flex; justify-content: center; gap: 15px; }

        .suggestion-form { padding: 20px; background-color: #fff8fa; border-radius: 10px; margin-top: 10px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #9b4d96; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 2px solid #f5a9bc; border-radius: 6px; font-size: 16px; font-family: inherit; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #9b4d96; box-shadow: 0 0 5px rgba(155,77,150,0.5); }
        .form-buttons { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
        .submit-btn { background-color: #2a0a3a; color: white; border: none; border-radius: 8px; padding: 12px 25px; cursor: pointer; font-size: 16px; font-weight: bold; transition: all 0.3s; }
        .submit-btn:hover { background-color: #5a005a; transform: translateY(-3px); }
        .cancel-btn { background-color: #f1a1c2; color: #2a0a3a; border: none; border-radius: 8px; padding: 12px 25px; cursor: pointer; font-size: 16px; font-weight: bold; transition: all 0.3s; }
        .cancel-btn:hover { background-color: #e91e63; color: white; transform: translateY(-3px); }
        
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1999; display: none; }

        .pagination-controls { display: flex; justify-content: center; margin-top: 20px; gap: 10px; }
        .page-btn { background-color: #9b4d96; color: white; border: none; border-radius: 8px; padding: 8px 15px; cursor: pointer; font-size: 14px; transition: all 0.3s; }
        .page-btn:hover { background-color: #ff66a3; transform: scale(1.05); }
        .page-btn:disabled { background-color: #cccccc; cursor: not-allowed; transform: none; }
        .page-indicator { display: flex; align-items: center; font-weight: bold; color: #9b4d96; }

        .spinner { display: inline-block; width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #9b4d96; animation: spin 1s ease-in-out infinite; margin: 20px auto; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255,255,255,0.8); display: flex; justify-content: center; align-items: center; z-index: 2000; flex-direction: column; }
        .loading-text { margin-top: 10px; color: #9b4d96; font-weight: bold; }

        .bow { position: absolute; width: 40px; height: 40px; background: url('https://i.imgur.com/tA7aPg4.png') center/contain no-repeat; z-index: 10; }
        .hearts-container { position: fixed; width: 100%; height: 100%; top: 0; left: 0; pointer-events: none; z-index: -1; overflow: hidden; }
        .heart { position: absolute; width: 30px; height: 30px; color: #f5a9bc; font-size: 30px; opacity: 0.7; animation: floatUpMovie 15s linear infinite; } /* Different animation name */
        @keyframes floatUpMovie { 0% { transform: translateY(100vh) scale(0.5) rotate(0deg); opacity: 0; } 10% { opacity: 0.7; } 90% { opacity: 0.7; } 100% { transform: translateY(-20vh) scale(1.2) rotate(360deg); opacity: 0; } }
        .header-bow-left { top: -15px; left: -15px; } .header-bow-right { top: -15px; right: -15px; }
        .main-bow-tl { top: -15px; left: -15px; } .main-bow-tr { top: -15px; right: -15px; }
        .main-bow-bl { bottom: -15px; left: -15px; } .main-bow-br { bottom: -15px; right: -15px; }

        .all-watched-container { background-color: #f0f8ff; border-radius: 10px; padding: 20px; margin-top: 20px; display: none; }
        .all-watched-title { color: #5a005a; margin-bottom: 20px; text-align: center; font-size: 1.5em; border-bottom: 2px solid #9b4d96; padding-bottom: 10px; }
        .genre-section { margin-bottom: 30px; }
        .genre-title { color: #9b4d96; font-size: 1.2em; margin-bottom: 10px; border-left: 5px solid #f5a9bc; padding-left: 10px; }

        /* ===== RESPONSIVE STYLES ===== */
        @media (max-width: 768px) {
            body {
                padding-left: 80px;
                padding-right: 0; /* Hide right nav */
            }
            .nav-container-left { width: 80px; }
            .nav-container-right { display: none; }
            .nav-item { font-size: 0; padding: 15px 0; }
            .nav-item img { width: 40px; height: 40px; margin-bottom: 0; }
            header { font-size: 1.5em; padding: 15px; }
            main { padding: 15px; } /* Reduced padding for main */
            .genre-container { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }
            .action-buttons { flex-direction: column; gap: 10px; }
            .form-buttons { flex-direction: column; }
            .movie-item { flex-direction: column; align-items: flex-start; gap: 5px; }
            .movie-actions { width: 100%; justify-content: space-between;}
            .watched-movie { flex-direction: column; align-items: flex-start; gap: 5px; }
            .watched-movie-actions { width: 100%; justify-content: space-between; }
        }
         @media (max-width: 480px) {
             body { padding-left: 60px; }
             .nav-container-left { width: 60px; }
             .nav-item img { width: 30px; height: 30px; }
             .genre-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">Loading movie database...</div>
    </div>

    <!-- Left Navigation -->
    <div class="nav-container-left">
        <a href="index.html" class="nav-item home">
            <img src="https://i.imgur.com/ZAl2gbp.png" alt="Home"> Home
        </a>
        <a href="loveletters.html" class="nav-item letters">
            <img src="https://i.imgur.com/ZVhcvD8.png" alt="Love Letters"> Love Letters
        </a>
        <a href="lovecalculator.html" class="nav-item calculator">
            <img src="https://i.imgur.com/megzmKr.png" alt="Love Calculator"> Love Calculator
        </a>
        <a href="movies.html" class="nav-item movies active"> <!-- Active for this page -->
            <img src="https://i.imgur.com/gzW8uSH.png" alt="Movie Picker"> Movie Picker
        </a>
        <a href="bookdate.html" class="nav-item bookdate">
            <img src="https://i.imgur.com/megzmKr.png" alt="Book a Date"> Book a Date
        </a>
        <a href="timezone.html" class="nav-item timezone">
            <img src="https://i.imgur.com/ZwOw9QN.png" alt="Time Bridge"> Time Bridge
        </a>
        <!-- Slime game link removed from left nav -->
    </div>
    
    <div class="overlay" id="overlay"></div>
    <div class="confirmation-dialog" id="confirmation-dialog">
        <p>Are you sure you want to reset all movie data?</p>
        <p>This will clear all your ratings and watched statuses!</p>
        <div class="dialog-buttons">
            <button class="reset-btn" id="confirm-reset">Yes, Reset All</button>
            <button class="watched-btn" id="cancel-reset">Cancel</button>
        </div>
    </div>

    <div class="confirmation-dialog" id="suggestion-dialog">
        <h2 style="color: #9b4d96; margin-bottom: 15px;">Suggest a New Movie</h2>
        <div class="suggestion-form">
            <div class="form-group">
                <label for="movie-title">Movie Title</label>
                <input type="text" id="movie-title" placeholder="Enter movie title" required>
            </div>
            <div class="form-group">
                <label for="movie-genre">Genre</label>
                <select id="movie-genre" required>
                    <option value="" disabled selected>Select a genre</option>
                    <option value="romance">Romance</option> <option value="comedy">Comedy</option>
                    <option value="fantasy">Fantasy</option> <option value="scifi">Sci-Fi</option>
                    <option value="horror">Horror</option> <option value="animation">Animation</option>
                </select>
            </div>
            <div class="form-buttons">
                <button type="button" class="submit-btn" id="submit-suggestion">Add Movie</button>
                <button type="button" class="cancel-btn" id="cancel-suggestion">Cancel</button>
            </div>
        </div>
    </div>

    <div class="page-wrapper">
        <header>
            Movie Night Picker ðŸŽ¬
            <img src="https://i.imgur.com/tA7aPg4.png" class="bow header-bow-left">
            <img src="https://i.imgur.com/tA7aPg4.png" class="bow header-bow-right">
        </header>

        <main>
            <img src="https://i.imgur.com/tA7aPg4.png" class="bow main-bow-tl">
            <img src="https://i.imgur.com/tA7aPg4.png" class="bow main-bow-tr">
            <img src="https://i.imgur.com/tA7aPg4.png" class="bow main-bow-bl">
            <img src="https://i.imgur.com/tA7aPg4.png" class="bow main-bow-br">
            
            <h2 style="color: #9b4d96; text-align: center; margin-bottom: 20px;">Choose a genre for our next movie night!</h2>
            
            <div class="reset-controls">
                <h3 style="color: #9b4d96;">Movie Tracker Controls</h3>
                <button id="reset-all-btn" class="reset-btn">Reset All Movie Data ðŸ”„</button>
            </div>
            
            <div class="genre-container"></div>
            
            <div class="action-buttons">
                <button id="show-watched-btn" class="action-btn"><span>ðŸŽ¬</span> Show All Watched Movies</button>
                <button id="suggest-movie-btn" class="action-btn"><span>âœ¨</span> Suggest a New Movie</button>
            </div>
            
            <div id="all-watched-container" class="all-watched-container"></div>
            <div id="movies-display"></div>
        </main>
    </div>

    <!-- Right Navigation Bar -->
    <div class="nav-container-right">
        <a href="slimegame.html" class="nav-item slimegame">
            <img src="https://i.imgur.com/yFzLbfM.png" alt="Slime Game Icon">
            Slime Game
        </a>
        <!-- Add other links if desired -->
    </div>

    <div class="hearts-container" id="hearts-container"></div>

    <script>
        // Default movie database (fallback in case API fails)
        let movieDatabase = { /* ... (same movie database as before) ... */ 
            romance: [ { title: "The Notebook", watched: false, rating: 0 }, { title: "Beastly", watched: false, rating: 0 }, { title: "La La Land", watched: false, rating: 0 }, { title: "Eternal Sunshine of the Spotless Mind", watched: false, rating: 0 }, { title: "Hitch", watched: false, rating: 0 } ],
            comedy: [ { title: "Superbad", watched: false, rating: 0 }, { title: "The Lost City", watched: false, rating: 0 }, { title: "The Secret Life of Walter Mitty", watched: false, rating: 0 }, { title: "Step Brothers", watched: false, rating: 0 }, { title: "Tag", watched: false, rating: 0 } ],
            fantasy: [ { title: "The Lord of the Rings", watched: false, rating: 0 }, { title: "Harry Potter Series", watched: false, rating: 0 }, { title: "Pan's Labyrinth", watched: false, rating: 0 }, { title: "Star Trek", watched: false, rating: 0 }, { title: "Reign of Fire", watched: false, rating: 0 } ],
            scifi: [ { title: "Snowpiercer", watched: false, rating: 0 }, { title: "Ready Player One", watched: false, rating: 0 }, { title: "District 9", watched: false, rating: 0 }, { title: "Blade Runner 2049", watched: false, rating: 0 }, { title: "Arrival", watched: false, rating: 0 } ],
            horror: [ { title: "Abigail", watched: false, rating: 0 }, { title: "The Conjuring", watched: false, rating: 0 }, { title: "The Pope's Exorcist", watched: false, rating: 0 }, { title: "Ash", watched: false, rating: 0 }, { title: "Salem's Lot", watched: false, rating: 0 } ],
            animation: [ { title: "Spirited Away", watched: false, rating: 0 }, { title: "Your Name", watched: false, rating: 0 }, { title: "Howl's Moving Castle", watched: false, rating: 0 }, { title: "Arrietty", watched: false, rating: 0 }, { title: "Kiki's Delivery Service", watched: false, rating: 0 } ]
        };
        const defaultMovieDatabase = JSON.parse(JSON.stringify(movieDatabase));
        const paginationState = { currentGenre: null, currentPage: 1, itemsPerPage: 5 };

        function createGenreCards() { /* ... (same as before) ... */ 
            const container = document.querySelector('.genre-container');
            container.innerHTML = '';
            for (const genre in movieDatabase) {
                const genreCard = document.createElement('div');
                genreCard.className = 'genre-card';
                genreCard.innerHTML = `<h3>${genre.charAt(0).toUpperCase() + genre.slice(1)}</h3>`;
                genreCard.addEventListener('click', () => {
                    paginationState.currentGenre = genre; paginationState.currentPage = 1;
                    showMoviesWithPagination(genre, 1);
                    document.getElementById('all-watched-container').style.display = 'none';
                });
                container.appendChild(genreCard);
            }
        }
        function showMoviesWithPagination(genre, page) { /* ... (same as before) ... */ 
            const moviesDisplay = document.getElementById('movies-display');
            const movies = movieDatabase[genre];
            paginationState.currentGenre = genre; paginationState.currentPage = page;
            const unwatchedMovies = movies.filter(movie => !movie.watched);
            const watchedMovies = movies.filter(movie => movie.watched);
            const startIndex = (page - 1) * paginationState.itemsPerPage;
            const endIndex = Math.min(startIndex + paginationState.itemsPerPage, unwatchedMovies.length);
            const currentPageMovies = unwatchedMovies.slice(startIndex, endIndex);
            const totalPages = Math.ceil(unwatchedMovies.length / paginationState.itemsPerPage);
            let html = `<div class="movies-container" style="display: block;"><h3 style="color: #9b4d96; margin-bottom: 15px; border-bottom: 2px solid #f5a9bc; padding-bottom: 5px;">${genre.charAt(0).toUpperCase() + genre.slice(1)} Movies</h3>`;
            if (currentPageMovies.length > 0) {
                html += currentPageMovies.map((movie, index) => {
                    const actualIndex = movieDatabase[genre].findIndex(m => m.title === movie.title);
                    return `<div class="movie-item" data-genre="${genre}" data-index="${actualIndex}"><div class="movie-title">${movie.title}</div><div class="movie-actions"><div class="star-rating" data-genre="${genre}" data-index="${actualIndex}"><span class="star ${movie.rating >= 1 ? 'active' : ''}" data-rating="1">â˜…</span><span class="star ${movie.rating >= 2 ? 'active' : ''}" data-rating="2">â˜…</span><span class="star ${movie.rating >= 3 ? 'active' : ''}" data-rating="3">â˜…</span><span class="star ${movie.rating >= 4 ? 'active' : ''}" data-rating="4">â˜…</span><span class="star ${movie.rating >= 5 ? 'active' : ''}" data-rating="5">â˜…</span></div><button class="watched-btn" data-genre="${genre}" data-index="${actualIndex}">Watched</button></div></div>`}).join('');
                if (unwatchedMovies.length > paginationState.itemsPerPage) {
                    html += `<div class="pagination-controls"><button class="page-btn" id="prev-page" ${page <= 1 ? 'disabled' : ''}>Previous</button><div class="page-indicator">Page ${page} of ${totalPages}</div><button class="page-btn" id="next-page" ${page >= totalPages ? 'disabled' : ''}>Next</button></div>`;
                }
            } else {
                if (unwatchedMovies.length === 0) { html += `<p style="text-align: center; color: #888;">No unwatched movies in this genre!</p>`; }
                else { html += `<p style="text-align: center; color: #888;">No more movies on this page.</p><div class="pagination-controls"><button class="page-btn" id="prev-page">Previous</button><div class="page-indicator">Page ${page} of ${totalPages}</div></div>`; }
            }
            if (watchedMovies.length > 0) {
                html += `<div class="watched-container"><h3 style="color: #5a005a; margin-bottom: 15px; border-bottom: 2px solid #9b4d96; padding-bottom: 5px;">Watched ${genre.charAt(0).toUpperCase() + genre.slice(1)} Movies</h3>`;
                html += watchedMovies.map(movie => {
                    const actualIndex = movieDatabase[genre].findIndex(m => m.title === movie.title);
                    return `<div class="watched-movie"><div class="movie-title">${movie.title}</div><div class="watched-movie-actions"><div class="rating-display">${'â˜…'.repeat(movie.rating)}${'â˜†'.repeat(5 - movie.rating)}</div><button class="undo-btn" data-genre="${genre}" data-index="${actualIndex}">Undo Watch</button></div></div>`}).join('');
                html += `</div>`;
            }
            html += `</div>`; moviesDisplay.innerHTML = html;
            addMovieEventListeners();
            const prevPageBtn = document.getElementById('prev-page'); const nextPageBtn = document.getElementById('next-page');
            if (prevPageBtn) { prevPageBtn.addEventListener('click', () => { if (page > 1) { showMoviesWithPagination(genre, page - 1); } }); }
            if (nextPageBtn) { nextPageBtn.addEventListener('click', () => { if (page < totalPages) { showMoviesWithPagination(genre, page + 1); } }); }
            moviesDisplay.scrollIntoView({ behavior: 'smooth' });
        }
        function showAllWatchedMovies() { /* ... (same as before) ... */ 
            document.getElementById('movies-display').innerHTML = '';
            const allWatchedContainer = document.getElementById('all-watched-container');
            allWatchedContainer.style.display = 'block';
            allWatchedContainer.innerHTML = '<h2 class="all-watched-title">All Watched Movies</h2>';
            let foundWatched = false;
            for (const genre in movieDatabase) {
                const watchedMovies = movieDatabase[genre].filter(movie => movie.watched);
                if (watchedMovies.length > 0) {
                    foundWatched = true;
                    const genreSection = document.createElement('div'); genreSection.className = 'genre-section';
                    const genreTitle = document.createElement('h3'); genreTitle.className = 'genre-title'; genreTitle.textContent = genre.charAt(0).toUpperCase() + genre.slice(1); genreSection.appendChild(genreTitle);
                    watchedMovies.forEach(movie => {
                        const actualIndex = movieDatabase[genre].findIndex(m => m.title === movie.title);
                        const movieElement = document.createElement('div'); movieElement.className = 'watched-movie';
                        movieElement.innerHTML = `<div class="movie-title">${movie.title}</div><div class="watched-movie-actions"><div class="rating-display">${'â˜…'.repeat(movie.rating)}${'â˜†'.repeat(5 - movie.rating)}</div><button class="undo-btn" data-genre="${genre}" data-index="${actualIndex}">Undo Watch</button></div>`;
                        genreSection.appendChild(movieElement);
                    });
                    allWatchedContainer.appendChild(genreSection);
                }
            }
            if (!foundWatched) { const noMoviesMsg = document.createElement('p'); noMoviesMsg.style.textAlign = 'center'; noMoviesMsg.style.color = '#888'; noMoviesMsg.style.marginTop = '20px'; noMoviesMsg.textContent = 'You haven\'t watched any movies yet!'; allWatchedContainer.appendChild(noMoviesMsg); }
            document.querySelectorAll('#all-watched-container .undo-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const genre = this.dataset.genre; const index = parseInt(this.dataset.index);
                    showLoadingOverlay('Unmarking as watched...');
                    const movie = movieDatabase[genre][index]; movie.watched = false;
                    updateMovieData(genre, movie.title, false, movie.rating).then(() => { hideLoadingOverlay(); showAllWatchedMovies(); }).catch(error => { console.error(error); hideLoadingOverlay(); alert("Failed to unmark."); movie.watched = true; });
                });
            });
            allWatchedContainer.scrollIntoView({ behavior: 'smooth' });
        }
        function showSuggestionDialog() { /* ... (same as before) ... */ document.getElementById('overlay').style.display='block'; document.getElementById('suggestion-dialog').style.display='block'; document.getElementById('movie-title').value=''; document.getElementById('movie-genre').selectedIndex=0; }
        function hideSuggestionDialog() { /* ... (same as before) ... */ document.getElementById('overlay').style.display='none'; document.getElementById('suggestion-dialog').style.display='none'; }
        function addMovieSuggestion() { /* ... (same as before) ... */ 
            const titleInput = document.getElementById('movie-title'); const genreSelect = document.getElementById('movie-genre');
            const title = titleInput.value.trim(); const genre = genreSelect.value;
            if (!title) { alert('Please enter a movie title'); return; } if (!genre) { alert('Please select a genre'); return; }
            if (movieDatabase[genre] && movieDatabase[genre].some(movie => movie.title.toLowerCase() === title.toLowerCase())) { alert('This movie already exists!'); return; }
            showLoadingOverlay('Adding movie suggestion...');
            const newMovie = { title: title, watched: false, rating: 0 };
            addNewMovie(genre, title).then(() => {
                if (!movieDatabase[genre]) { movieDatabase[genre] = []; } movieDatabase[genre].push(newMovie);
                hideSuggestionDialog(); hideLoadingOverlay(); alert(`Added "${title}" to ${genre}!`); createGenreCards();
                if (paginationState.currentGenre === genre) { showMoviesWithPagination(genre, 1); }
            }).catch(error => { console.error(error); hideLoadingOverlay(); alert("Failed to add movie: " + error.message); });
        }
        function addNewMovie(genre, title) { /* ... (same as before) ... */ 
            return new Promise((resolve, reject) => {
                const scriptId = `add_script_${Date.now()}_${Math.floor(Math.random()*1000000)}`; const callbackName = `add_callback_${Date.now()}_${Math.floor(Math.random()*1000000)}`;
                const scriptUrl = new URL("https://script.google.com/macros/s/AKfycbz3VDA2UqebJNJBFUqTt_15bPh_U4Ywho_ZCtDot56xxwczgGKnVB8DL0AXvHZChWRK/exec");
                scriptUrl.searchParams.append('Genre', genre); scriptUrl.searchParams.append('Title', title); scriptUrl.searchParams.append('Watched', "FALSE"); scriptUrl.searchParams.append('Rating', "0"); scriptUrl.searchParams.append('action', "add"); scriptUrl.searchParams.append('callback', callbackName); scriptUrl.searchParams.append('_', Date.now());
                const cleanup = () => { const scriptElement = document.getElementById(scriptId); if (scriptElement && scriptElement.parentNode) { scriptElement.parentNode.removeChild(scriptElement); } if (window[callbackName]) { delete window[callbackName]; } };
                window[callbackName] = function(response) { cleanup(); if (response && response.error) { reject(new Error(response.error)); return; } resolve(response || { success: true }); };
                const script = document.createElement('script'); script.id = scriptId; script.src = scriptUrl.toString();
                script.onerror = function() { cleanup(); reject(new Error(`Network error adding ${title}`)); };
                document.body.appendChild(script);
                setTimeout(() => { if (window[callbackName]) { cleanup(); reject(new Error(`Timeout adding ${title}`)); } }, 15000);
            });
        }
        function addMovieEventListeners() { /* ... (same as before) ... */ 
            document.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', function() {
                    const genre = this.parentElement.dataset.genre; const index = parseInt(this.parentElement.dataset.index); const rating = parseInt(this.dataset.rating);
                    showLoadingOverlay('Updating rating...'); const movie = movieDatabase[genre][index]; movie.rating = rating;
                    const stars = this.parentElement.querySelectorAll('.star'); stars.forEach(s => { s.classList.toggle('active', parseInt(s.dataset.rating) <= rating); });
                    updateMovieData(genre, movie.title, movie.watched, rating).then(() => hideLoadingOverlay()).catch(error => { console.error(error); hideLoadingOverlay(); alert("Failed to update rating."); });
                });
            });
            document.querySelectorAll('.watched-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const genre = this.dataset.genre; const index = parseInt(this.dataset.index);
                    showLoadingOverlay('Marking as watched...'); const movie = movieDatabase[genre][index]; movie.watched = true;
                    updateMovieData(genre, movie.title, true, movie.rating).then(() => { hideLoadingOverlay(); showMoviesWithPagination(genre, paginationState.currentPage); }).catch(error => { console.error(error); hideLoadingOverlay(); alert("Failed to mark watched."); movie.watched = false; });
                });
            });
            document.querySelectorAll('.undo-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const genre = this.dataset.genre; const index = parseInt(this.dataset.index);
                    showLoadingOverlay('Unmarking as watched...'); const movie = movieDatabase[genre][index]; movie.watched = false;
                    updateMovieData(genre, movie.title, false, movie.rating).then(() => { hideLoadingOverlay(); showMoviesWithPagination(genre, paginationState.currentPage); }).catch(error => { console.error(error); hideLoadingOverlay(); alert("Failed to unmark."); movie.watched = true; });
                });
            });
        }
        function showLoadingOverlay(message = 'Loading...') { /* ... (same as before) ... */ const overlay=document.getElementById('loading-overlay'); const loadingText=overlay.querySelector('.loading-text'); loadingText.textContent=message; overlay.style.display='flex'; }
        function hideLoadingOverlay() { /* ... (same as before) ... */ document.getElementById('loading-overlay').style.display='none'; }
        function resetAllData() { /* ... (same as before) ... */ 
            showLoadingOverlay('Resetting all movie data...');
            movieDatabase = JSON.parse(JSON.stringify(defaultMovieDatabase));
            const updatePromises = [];
            for (const genre in movieDatabase) { for (const movie of movieDatabase[genre]) { updatePromises.push(updateMovieData(genre, movie.title, false, 0)); } }
            Promise.all(updatePromises).then(() => {
                hideLoadingOverlay(); document.getElementById('movies-display').innerHTML = ''; document.getElementById('all-watched-container').style.display = 'none';
                paginationState.currentGenre = null; paginationState.currentPage = 1; createGenreCards(); alert('All movie data has been reset!');
            }).catch(error => { console.error(error); hideLoadingOverlay(); alert("Failed to reset data."); });
        }
        function createHearts() { /* ... (same as before) ... */ 
            const container = document.getElementById('hearts-container'); container.innerHTML = '';
            for (let i = 0; i < 20; i++) { const heart = document.createElement('div'); heart.className = 'heart'; heart.innerHTML = 'â¤ï¸'; heart.style.left = `${Math.random()*100}vw`; heart.style.animationDuration = `${10+Math.random()*15}s`; heart.style.animationDelay = `${Math.random()*5}s`; heart.style.fontSize = `${15+Math.random()*25}px`; container.appendChild(heart); }
        }
        function setActiveNav() { /* ... (same as before, now handles both navs) ... */ 
            const leftNavItems = document.querySelectorAll('.nav-container-left .nav-item');
            const rightNavItems = document.querySelectorAll('.nav-container-right .nav-item');
            const allNavItems = [...leftNavItems, ...rightNavItems];
            let path = window.location.pathname.split('/').pop(); if (path === "" || path === "index.html") { path = "index.html"; }
            allNavItems.forEach(item => { item.classList.remove('active'); if (item.getAttribute('href') === path) { item.classList.add('active'); } });
        }
        function showConfirmationDialog() { /* ... (same as before) ... */ document.getElementById('overlay').style.display='block'; document.getElementById('confirmation-dialog').style.display='block'; }
        function hideConfirmationDialog() { /* ... (same as before) ... */ document.getElementById('overlay').style.display='none'; document.getElementById('confirmation-dialog').style.display='none'; }
        function fetchMovieData() { /* ... (same as before) ... */ 
            return new Promise((resolve, reject) => {
                showLoadingOverlay('Loading movies...'); const scriptId = `fetch_script_${Date.now()}`; const callbackName = `fetch_callback_${Date.now()}`;
                const scriptUrl = new URL("https://script.google.com/macros/s/AKfycbz3VDA2UqebJNJBFUqTt_15bPh_U4Ywho_ZCtDot56xxwczgGKnVB8DL0AXvHZChWRK/exec");
                scriptUrl.searchParams.append('callback', callbackName); scriptUrl.searchParams.append('_', Date.now());
                const cleanup = () => { const el=document.getElementById(scriptId); if(el&&el.parentNode)el.parentNode.removeChild(el); if(window[callbackName])delete window[callbackName]; };
                window[callbackName] = function(data) {
                    cleanup();
                    if (data && data.error) { console.error("API Error:", data.error); createGenreCards(); hideLoadingOverlay(); reject(new Error(data.error)); return; }
                    if (!Array.isArray(data)) { console.error("Format Error:", data); createGenreCards(); hideLoadingOverlay(); reject(new Error("Format Error")); return; }
                    const tempDb = {}; let movieCount = 0;
                    data.forEach(row => { const genre = row.Genre.toLowerCase(); if(!tempDb[genre])tempDb[genre]=[]; const isWatched = row.Watched==="TRUE"||row.Watched===true; tempDb[genre].push({title:row.Title, watched:isWatched, rating:parseInt(row.Rating)||0}); movieCount++; });
                    if (Object.keys(tempDb).length > 0) { movieDatabase = tempDb; }
                    createGenreCards(); hideLoadingOverlay(); resolve(true);
                };
                const script = document.createElement('script'); script.id = scriptId; script.src = scriptUrl.toString();
                script.onerror = function() { cleanup(); console.warn("Script load error, using default data."); createGenreCards(); hideLoadingOverlay(); reject(new Error("Script load error")); };
                document.body.appendChild(script);
                setTimeout(() => { if (window[callbackName]) { cleanup(); console.warn("Timeout, using default data."); createGenreCards(); hideLoadingOverlay(); reject(new Error("Timeout")); } }, 15000);
            });
        }
        function updateMovieData(genre, title, watched, rating) { /* ... (same as before) ... */ 
             return new Promise((resolve, reject) => {
                const watchedValue = watched ? "TRUE" : "FALSE"; const scriptId = `jsonp_${Date.now()}_${Math.floor(Math.random()*1000000)}`; const callbackName = `callback_${Date.now()}_${Math.floor(Math.random()*1000000)}`;
                const scriptUrl = new URL("https://script.google.com/macros/s/AKfycbz3VDA2UqebJNJBFUqTt_15bPh_U4Ywho_ZCtDot56xxwczgGKnVB8DL0AXvHZChWRK/exec");
                scriptUrl.searchParams.append('Genre', genre); scriptUrl.searchParams.append('Title', title); scriptUrl.searchParams.append('Watched', watchedValue); scriptUrl.searchParams.append('Rating', rating.toString()); scriptUrl.searchParams.append('callback', callbackName); scriptUrl.searchParams.append('_', Date.now());
                const cleanup = () => { const el=document.getElementById(scriptId); if(el&&el.parentNode)el.parentNode.removeChild(el); if(window[callbackName])delete window[callbackName]; };
                window[callbackName] = function(response) { cleanup(); if (response&&response.error){reject(new Error(response.error)); return;} resolve(response||{success:true}); };
                const script = document.createElement('script'); script.id = scriptId; script.src = scriptUrl.toString();
                script.onerror = function(){cleanup(); reject(new Error(`Network error updating ${title}`));};
                document.body.appendChild(script);
                setTimeout(() => { if(window[callbackName]){cleanup(); reject(new Error(`Timeout updating ${title}`));}}, 15000);
            });
        }

        window.addEventListener('load', () => {
            createHearts(); setActiveNav();
            fetchMovieData().catch(error => { console.error("Init failed:", error); });
            document.getElementById('reset-all-btn').addEventListener('click', showConfirmationDialog);
            document.getElementById('confirm-reset').addEventListener('click', () => { resetAllData(); hideConfirmationDialog(); });
            document.getElementById('cancel-reset').addEventListener('click', hideConfirmationDialog);
            document.getElementById('show-watched-btn').addEventListener('click', showAllWatchedMovies);
            document.getElementById('suggest-movie-btn').addEventListener('click', showSuggestionDialog);
            document.getElementById('submit-suggestion').addEventListener('click', addMovieSuggestion);
            document.getElementById('cancel-suggestion').addEventListener('click', hideSuggestionDialog);
        });
    </script>
</body>
</html>
